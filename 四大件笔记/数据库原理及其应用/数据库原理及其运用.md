# 数据库原理及其运用

## 绪论

基本概念

1. 数据:描述事物的符号记录

2. 数据库:概括地讲，数据库数据具有永久存储、有组织和可共享的三个基本特点。
    严格地讲:数据库是长期储存在计算机内、有组织的、可共享的大量数据的集合。数据库中的数据按一定的数据模型组织、描述和储存，具有较小的几余度、较高的数据独立性和易扩展性，并可为各种用户共享。

3. 数据库管理系统:是位于用户和操作系统之间的一层数据管理软件。**和操作系统一样是计算机的基础软件**

    - 主要功能：
    - 1.**数据定义功能**           2.**数据组织、存储和管理**               3.数据操纵                4.**数据库的事务管理和运行管理**
        5.数据库的建立和维护功能                 6.其他功能(通信功能，数据转换功能，互访和互操作功能等)

4. 数据库系统:是由数据库、**数据库管理系统**(及其应用开发工具)、**应用程序**和**数据管理员DBA)组成的存、管理处理和护数据的`系统`**

    ![image-20231207075935174](%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207075935174.png)

发展阶段：

1. 人工管理阶段**:数据不保存、不共享**，不具有独立性
2. 文件系统阶段**:可保存，但共享性差，冗余度大**，独立性差
3. 数据库管理系统:数据库系统的出现使信息系统从以 加工数据的程序为中心 转向围绕共享的数据库 为中心的新阶段实现整体数据的结构化
    数据的**共享性高、冗余度低且易扩充**: 数据共享可以大大减少数据冗余，节约存储空间数据独立性高:
    物理独立性:是指用户的应用程序与数据库中**数据**的**物理存储是相互独立的**。
    逻辑独立性:是指用户的应用程序与数据库的**逻辑结构是相互独立的**。
    数据由**数据库管理系统统一**管理和控制



数据模型：

两类数据模型:概念模型模型和物理模型人们先将现实世界象为信息世界，然后将信息世界转还为机器世界)

1. 概念模型:也称**信息模型**，它是按用户观点来对数据和信息**建模**，主要用于数据库设计。
    - 基本概念:
    - **实体**:客观存在并可相互区别的事物。 人
    - **属性**:实体所具有的某一特性。 人的鼻子 嘴巴
    - **码**:唯一标识实体的属性。 学号
    - **实体型**:用**实体名**及其**属性**集合来抽象和刻画**同类实体**。含有鼻子和嘴巴的人
    - **实体集**:**同一类型实体**的集合。学校
    - 联系:实体之间的联系通常是指不同实体集之间的联系。实体之间的联系有一对一、一对多和多对多等多种联系
    - 概念模型的一种表示方法:实体-联系方法。用E-R图来描述现实世界的概念模型，E-R方法也称为E-R模型
2. 逻辑模型:它是按计算机系统的**观点对数据建模**，主要用于数据库管理系统的实现。
    - 包括：**层次模型、网状模型、关系模型**(第三章我们主要讲它)
    - 物理模型:**是对数据最底层的抽象**，它描述数据在系统内部的表示方法和存取方法，或在磁盘或磁带上的存储方式和存取方法，是面向计算机系统的。
    - 联系:实体之间的联系通常是指不同实体集之间的联系实体之间的联系有一对一、一对多和多对多等多种联系实体内部的联系通常是指实体各属性之间的联系



ER图：

![image-20231207081023726](%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207081023726.png)

ER图分为**实体、属性、关系**三个核心部分。**实体是长方形体现，而属性则是圆形，关系为菱形**



常用数据模型：层次模型，网状模型，关系模型，面向对象数据模型，对象关系数据模型，半结构化数据模型。

1. 层次模型：

    - 有且只有一个结点没有双亲结点，这个结点称为根结点
    - 根以外的其他结点有且只有一个双亲结点。
    - <img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207081315442.png" alt="image-20231207081315442" style="zoom:50%;" />

    

    

    2. 网状模型

    - 允许一个节点以上没有双亲
    - 一个节点可以有多个双亲
    - <img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207083528983.png" alt="image-20231207083528983" style="zoom:50%;" />

    3. 关系模型<img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207083636739.png" alt="image-20231207083636739" style="zoom:50%;" />
        - 关系:一个关系对应通常说的一张表。
        - 元组:表中的一行。
        - 属性:表中的一列
        - 码:也称码键，表中的某个属性组
        - 域:是一组具有相同数据类型的值的集合
        - 分量:元组中的一个属性，比如年龄，学号等

    

    

    

    数据库系统的结构

    1. 模式数据库中全体数据的逻辑结构和特征的描述，它仅仅涉及型的描述，不涉及具体的值。其一个具体值称为模式的一个实例

    模式是相对稳定的，实例是相对变动的。

    三级模式结构:外模式+模式+内模式

    - 外式:也称子模式或**用户模式**，它是数据库用户包括应用程序员和最终用户能够看见和使用的局部数据的逐结构和特征的描述，是数据库用户的数据视图，是**与某一应用有关的数据的逻辑表示**
    - 模式:也称为逻辑模式，是数据库中全体数据的逻辑结构和特征的描述，是**所有用户的公共数据视图**
    - 内模式:**也称存储模式**，**一个数据库只有一个内模式**。它是数据物理结构和存储方式的描述，是数据在数据库内部的组织方式

    2. 二级映像：
        - 外模式/模式映像:**当模式改变时**，由数据库管理员对各个**外模式/模式映像作相应改变，可以使外模式保持不变**。应用程序不必修改。保证了数据与程序的逻辑独立性。
        - 摸式/内模式映像:当数据库的存储结构改变时，有数据库管理员对模式/内模式作相应改变，可以使模式保持不变，从而应用程序也不用改变。保证了数据与程序的物理独立性
        - 数据与程序之间的独立性使得数据的定义和描述可以从应用程序中分离出去。另外，由于数据的存取由数据库管理系统管理，从而简化了应用程序的编制，大大减少了应用程序的维护和修改。

    

    数据库系统的组成

    1. **硬件平台及数据库**：足够大内存、磁盘或磁盘阵列等设备，较高的通道能力以提高数据的传送率。
    2. **软件、数据库管理系统、支持数据库管理系统运行的操作系统**，具有与数据库接口的高级语言及其编译系统，以数据库管理系统为核心的应用开发工具，为特定应用环境开发的数据库应用系统。
    3. **人员**：**开发、管理和使用**数据库的人员主要包括数据库管理员、系统分析员和数据库设计人员、应用程序员和最终用户。

    **数据库管理员**职责:**决定数据库中的信息内容和构、决定数据库的存储结构和存取策略、定义数据的安全性要求和完整性约束条件、监控数据库的使用和运行、数据库的改进和重组、重构。**

    

    

    

    

    

    

## 关系数据库

    关系模型：（了解）
    
    - 关系模式:对关系的描述
    - 那么什么是关系?
        关系是一张表，一张二维表
    - 关系有哪些需要描述?
        1关系中有哪些属性
        2、这些属性来自哪些域
        3、属性与域之间的映射关系
    - 可以形象地表示为
        R(U,D,DOM,F)
        R:关系名
        U:所有属性名
        D:属性来自哪些域
        DOM:属性和域的映射
        F:属性间的依赖关系
    - 关系数据库:
        关系数据库也有关系数据库模式
    
    关系操作：
    
    - 关系操作:
    - 插入、查询、删除、修改
    - 其中查询操作分为:选择、投影、连接、除法、并、差、交、笛卡尔积
    - 查询操作的基本操作:择、投影、并、差、笛卡尔积


​    

​    

    关系语言的分类：
    
    分为关系代数语言(重点重点)			关系演算语言(不重要)			SQL语言(后面重点讲)
    
    关系代数是**一种抽象的查询语言**，它用对关系的**运算来表达查询**。
    三大要素:运算对象(关系)、运算符(集合运算符和专门的关系运算符)和运算结果 (关系)
    
    <img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207085206646.png" alt="image-20231207085206646" style="zoom:67%;" />
    
    关系代数运算:5种基本运算:并，差，笛卡儿积，选择，投影及交，连接，除。
    
    交$A\cap B$：A和B共有：<img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207085354748.png" alt="image-20231207085354748" style="zoom:80%;" />
    
    并$A\cup B$：A或B有：<img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207085612416.png" alt="image-20231207085612416" style="zoom:50%;" />
    
    差$A-B$：A中且不属于B的部分：<img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207085729845.png" alt="image-20231207085729845" style="zoom:50%;" />

选择![image-20231207090147076](%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207090147076.png)

投影：![image-20231207090433069](%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207090433069.png)

相当于只选择展示表中的Sname和Sdept属性



连接：分为自然连接，外连接，左外连接，右外连接

- 自然连接：把共同属性进行等值连接
    - <img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207091128311.png" alt="image-20231207091128311" style="zoom:70%;" />
    - 比如上面R和S都有B，D属性，然后查看BD属性都相同的共同连接
    - 悬浮元组：两个关系R和S在做自然连接时，关系R中某些元组有可能在S中不存在公共属性上值相等的元组，从而造成R中这些元组在操作时被舍弃了，这些被舍弃的元组称为悬浮元组。
    - 比如上面表格中，第2，3行没有使用到就是废弃的元组
- 外连接：如果把悬浮元组也保存在结果关系中，而在其他属性上填空值(Null)，就叫做外连接
    - 左外连接：只保留左边关系R中的悬浮元组
    - 右外连接：只保留右边关系S中的悬浮元组

除：保留R中满足S的，且R中列要去除S中列

<img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207091838358.png" alt="image-20231207091838358" style="zoom:67%;" />

<img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207092022624.png" alt="image-20231207092022624" style="zoom:67%;" />

关系的完整性：

1. 实体完整性
    主码唯一且非空

2. 参照完整性
    外码要么为空,要么对应另一表的主码

3. 用户定义完整性

    你自己写的要完整,比如学号多少,姓名,班级,专业之类







## SQL语言

###  概述

使用的时候不区分大小写



基本概念：SQL是Structured Query Lanquage的缩写，意思是结构化查询语言，是一种在数据库管理系统中查询或对数据库里面的数据进行更改的语言

主要有：![image-20231207092638183](%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207092638183.png)



关系型：是放在表格里面的；非关系型是放在集合里面的

不同数据库管理系统的SQL语言略有不同

1. 数据定义语言DDL (Data Ddefinition Language)
    SQL数据定义语言主要用来**定义逻辑结构**，包括定义基表，视图和索引。
    删除表	定义表	修改表

2. 数据查询语言DQL (Data Query Language)
    SQL的数据查询语言主要用来对数据库中的**各种数据对象进行查询**

3. 数据操纵语言DML (Data Manipulation Language)

    SQL的数据操纵语言，用于**改变数据库中的数据**，包括插入，删除，修改

4. 数据控制功能DCL (Data Control Language)
    SQL的数据控制语言，对**表和视图的授权**，完整性规则的描述以及事务开始和结束等控制语句。

SQL语言的特点：

1. 综合统一(独立完成数据库生命周期中的全部活动，包括定义关系模式、录入数据、建立数据库、查询、更新、维护、数据库重构、数据库安全
2. 高度**非过程化**(用户只需提出“做什么”，而不必指明“怎么做”。)
3. **面向集合的操作方式**(SQL采用集合操作方式)
4. 以同一种语法结构提供两种使用方式(SQL既是**自含式语言**，又是**嵌入式语言**。SQL语句能够嵌入到高级语言程序中，)
5. 语言简洁，易学易用 (SQL语言语法简单，接近英语口语，因此容易学习，也容易使用。)



SQL的基本语法：

- 数据类型<img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231207093525644.png" alt="image-20231207093525644" style="zoom:67%;" />
- <img src="%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231210190717706.png" alt="image-20231210190717706" style="zoom:67%;" />

表的定义和删除

定义：

>create table 表名（字段名   类型名   字段约束，字段名   类型名   字段约束）；
>
>比如
>
>create table user(
>
>name varchar(20),
>
>age int,
>
>sex char(1)
>
>)



删除

DROP TABLE <表名> [RESTRICT| CASCADE];

例如：DROP TABLE Student CASCADE;

CASCADE 是如果表有外键，视图     触发器的话，也会强行删除，RESRICT恰恰相反（外键：和其他的视图关联起来）



修改：

ALTER TABLE <表名> ADD <新列名><数据类型>



索引

为了方便查询，索引必须是独一无二

索引的建立，CREATE [UNIQUE] [CLUSTER] INDEX <索引名>

> CLUSTER：聚簇索引：物理顺序和索引顺序相同
>
> UNIQUE：唯一索引

比如：create unique index stu_id_index on test(id)，这句话就是给test表里面的id 





修改：

ALTER INDEX <旧索引名> RENAME TO <新索引名>

例如：ALTER INDEX SCno RENAME TO SCSno;

删除：

DROP INDEX <索引名>





### 使用

查询所有列：

Select * from Student    ，相当于将student表的所有列查询出来

起别名：select id (as) <标识> ,title (as) <课程名> from edu_course;



结果去重

select distinct title 课程名字 from edu_course;



查询结果+条件

查询条件![image-20231211135623343](%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231211135623343.png)

常用的有比较，确定范围，确定集合，多重条件  

比较条件：<>等同于 !=

确定范围：between 1 and 3，在1和3之间

确定集合：in，确定是否在这个集合里面

字符串匹配：模糊的匹配，like，not like



使用的时候需要加where

比如：select distinct title 课程名字 from edu_course where price>2;

select distinct title 课程名字 from edu_course where price between 1 and 100;

集合：select 1 in (1,2)，返回1代表在这个集合中

字符匹配：`select * from edu_course where title like ‘%速成’;`找到所有匹配带有速成的。  %匹配全部字符，_匹配一个字符





聚集函数

![image-20231211191751929](%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231211191751929.png)

count(*)统计元组个数

count([distinct|all] <列名>)      统计一列中值 的个数

sum([distinct|all] <列名>)  计算某一列中值的总和（此列必须是数据型）

avg([distinct | all] <列名> )  计算一列中值的平均值

max([distinct|all] <列名>) 某一列中的最大值

min([distinct|all] <列名>)   某一列中的最小值





分组查询

Group by分组 ，如果要进行筛选，请使用Having

Group by后面不能跟where进行查询

比如`select teacher_id from edu_course Group by teacher_id Having  teacher_id=13 `



连接：

等值和非等值连接，以where为关键字

`select * from edu_course ec, edu_course_description ecd where ec.id=ecd.id`

自身连接：

一个表与自身连接，为本身这个表起两个别名，然后进行操作

`select * from edu_course ec1, edu_course ec2 where ec1.id=ec2.id`

外连接

把舍弃的值，也保留在结果中，但是要加NULL

左外连接，把左边表里面的值弄出来和右边表里面的值并在一起

`select * from edu_course ec left outer join edu_course_description ecd on ec.id=ecd.id`

右外连接

去掉left outer



多表查询

`select * from edu_course ec,edu_course_description ecd,edu_chapter ech where ec.id=ecd.id and ec.id = ech.course_id`

嵌套查询

`select * from edu_course ec where teacher_id in (select teacher_id from edu_course where teacher_id=10 or teacher_id=0)`



带有ANY ALL的子查询

![image-20231211194718114](%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86%E5%8F%8A%E5%85%B6%E8%BF%90%E7%94%A8.assets/image-20231211194718114.png)

比如`select * from edu_course ec where price>ALL (select price from edu_course where price < 10)`如果后面查询出来的结果是0，2

那么选择的是所有price大于2的值



带exists的子查询

not exists 如果后面的子查询没有值，返回1 否则为0
exidts 相反