# 浏览器工作原理笔记

## 进程VS线程

进程：是程序的一个运行实例。

线程：不能单独存在，依附在进程上的一个完成任务的执行路径。

两者的关系：一个进程可以包含多个线程，一个线程只能服务于一个进程。

多线程模式，极大的提高了浏览器对任务的处理速度。

特点：任何一个线程都是不可或缺的，如果出错，整个进程都会随之崩溃。（2）对于同进程的不同线程，可以共享进程的数据（3）当一个进程关闭之后，操作系统会回收进程所占用的内存（4）进程之间的内容相互隔离，以免因为一个页面崩溃而影响其他不相干的页面崩溃



目前Chrome浏览器进程

![img](https://static001.geekbang.org/resource/image/b6/fc/b61cab529fa31301bde290813b4587fc.png)

浏览器主进程：主要管控页面显示，用户交互等，还有存储功能。

网络进程：负责页面的网络资源加载等。

GPU进程：绘制页面。起初是为了绘制3D CSS

渲染进程：将HTML、CSS、JavaScript等代码转化为用户可以交互的页面。该进程是在沙箱模式下进行的，为了安全。

插件进程：负责插件的运行。

PS：沙箱模式：给运行程序外面套一个盒子，不影响其正常运行，但是会阻止其不安全行为，例如在硬盘上随意的写入任何数据，读取敏感位置的数据等。早期的浏览器插件可以用c\c++来写，因此可以访问系统下任何资源并且操作，具有极大的安全隐患。



我认为，推动浏览器发展的主要动力：安全性，流畅度，轻便程度。主要是这三个方向



## 数据的传递

要满足传递数据，那么必须符合网络协议（简称IP）。数据是以数据包的形式传递，而且如果数据包较大，那么会分散成很多小的数据包，进行传递。

访问网站的实质：一台计算机向另一台计算机请求信息。

IP地址：一台计算机的地址。在A向B发送数据包时，数据包会加上IP头，以存储A的IP地址（数据包发送的地方）和B的IP地址（数据包到达的地方）等其他信息。

如果还需要精确，比如送到哪个程序上，那么需要基于基于IP之上开发能和应用打交道的协议，常见的是`用户数据包协议`，简称UDP（User Datagram Protocol），其最重要的信息是端口号。

IP通过IP地址信息把数据包发送给指定的电脑，而UDP通过端口号把数据包分发给正确的程序。就类似快递，IP是哪个地址，而UDP是决定给哪个人。

缺点：在使用UDP发送数据时，有各种因素会导致数据包出错，虽然UDP可以校验数据是否正确，但是对于错误的数据包，UDP并不提供重发机制，只是丢弃当前的包，而且UDP在发送之后也无法知道是否能达到目的地。UDP不能保证数据可靠性，但是传输速度却非常快。

大文件会被拆分成很多小的数据包来传输，这些小的数据包会经过不同的路由，并在不同的时间到达接收端，而UDP协议并不知道如何组装这些数据包，从而把这些数据包还原成完整的文件。



TCP（Transmission Control Protocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议，对于数据包丢失的情况，TCP提供重传机制；此外，TCP引入了数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件。



*   IP负责把数据包送达目的主机。
*   UDP负责把数据包送达具体应用。
*   而TCP保证了数据完整地传输，它的连接可分为三个阶段：建立连接、传输数据和断开连接。





## HTTP协议

建立在TCP协议之上的一种允许浏览器向服务器获取资源的协议，是Web的基础。同样也是浏览器使用最为广泛的协议。HTTP的内容是通过TCP的传输数据阶段来实现

域名和IP地址有着一一对应的关系，是通过域名系统（Domain Name System，即DNS）来进行建立的关系。所以在访问域名的时候通过DNS获取到域名对应的IP地址，进而传输数据。DNS还有缓存功能，即访问过的网站，在下次查询的时候直接使用而不是再去发起一个网络请求

有时候输入网址，不加www.开头也能进入相应的网址，是因为重定向。

二次页面打开很快，主要原因是第一次加载页面过程中，缓存了一些耗时的数据。

DNS缓存和页面资源缓存。



浏览器中的HTTP请求从发起到结束一共经历了如下八个阶段：构建请求、查找缓存、准备IP和端口、等待TCP队列、建立TCP连接、发起HTTP请求、服务器处理请求、服务器返回请求和断开连接。





## URL到页面展示

用户输入：（1）判定是搜索内容，会合成带搜索关键字的URL。（2）输入内容符合URL规则，会自动加上协议，合成完整的URL



URL请求过程：



